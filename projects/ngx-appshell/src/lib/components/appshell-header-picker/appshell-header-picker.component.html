<div class="header-picker">
    <button [matMenuTriggerFor]="pickerMenu" #pickerTrigger="matMenuTrigger"
        (menuOpened)="onMenuOpened()"
        [class.active]="pickerTrigger.menuOpen">
        {{ selectedLabel() }}
        <appshell-icon [icon]="pickerTrigger.menuOpen ? 'expand_less' : 'expand_more'" />
    </button>
</div>

<mat-menu #pickerMenu="matMenu" xPosition="after" class="appshell-header-picker-panel">
    @if (searchable()) {
        <div class="picker-search-ctn"
            (click)="$event.stopPropagation()"
            (mousedown)="$event.stopPropagation()"
            [hidden]="!picker().options || picker().options.length === 0">
            <mat-form-field>
                @if (!search) {
                    <appshell-icon matPrefix class="prefix-icon" aria-label="Search icon" [icon]="'search'" />
                }
                <input matInput type="text" placeholder="Search for ..." aria-label="Search options"
                    [(ngModel)]="search" (keydown)="onSearchKeydown($event)"
                    #searchInput />
                @if (search) {
                    <button matSuffix aria-label="Clear" (click)="search=''">
                        <appshell-icon [icon]="'close'" aria-hidden="true" />
                    </button>
                }
            </mat-form-field>
        </div>
    }
    <div class="picker-options-ctn">
        @for (opt of filteredOptions(); track opt) {
            <button mat-menu-item (click)="onPick(opt)" (keypress)="onPick(opt)"
                [class.active]="picker().selected === opt" attr.aria-label="{{ opt }}">
                {{ opt }}
            </button>
        }
        @if (!picker().options || picker().options.length === 0) {
            <div class="no-options-text">
                @if (picker().noOptionsTitle) {
                    <b>{{ picker().noOptionsTitle }}</b>
                }
                @if (picker().noOptionsMessage) {
                    <div [innerHTML]="picker().noOptionsMessage"></div>
                }
            </div>
        } @else if (searchable() && filteredOptions().length === 0) {
            <div class="no-options-text">
                @if (picker().noFilteredOptionsTitle) {
                    <b>{{ picker().noFilteredOptionsTitle }}</b>
                }
                @if (picker().noFilteredOptionsMessage) {
                    <div [innerHTML]="picker().noFilteredOptionsMessage"></div>
                }
            </div>
            <button class="clear-search-btn" mat-button
                (click)="search=''; $event.stopPropagation()" aria-label="Clear search">
                Clear search
            </button>
        }
    </div>
</mat-menu>
